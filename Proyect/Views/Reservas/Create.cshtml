@model Proyect.Models.Reserva

@{
    ViewData["Title"] = "Crear Reserva";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <h1 class="Tituloscentro">Crear Nueva Reserva</h1>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Formulario de Reserva</h6>
        </div>
        <div class="card-body">
            <form asp-action="Create" id="createReservaForm">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <!-- Documento del Cliente -->
                <div class="form-group">
                    <label for="DocumentoCliente" class="control-label">Documento del Cliente</label>
                    <input type="text" id="DocumentoCliente" class="form-control" placeholder="Ingrese el documento del cliente" />
                    <button type="button" class="btn btn-info mt-2" id="buscarCliente">Buscar Cliente</button>
                </div>

                <!-- Información del Cliente -->
                <div id="clienteInfo" style="display:none;">
                    <h5>Datos del Cliente:</h5>
                    <p><strong>Nombre:</strong> <span id="clienteNombre"></span></p>
                    <p><strong>Apellido:</strong> <span id="clienteApellido"></span></p>
                    <p><strong>Celular:</strong> <span id="clienteCelular"></span></p>
                    <p><strong>Correo:</strong> <span id="clienteCorreo"></span></p>
                    <input type="hidden" id="IdCliente" name="IdCliente" />
                </div>

                <!-- Botón para crear Cliente -->
                <button type="button" class="btn btn-info mt-2" data-toggle="modal" data-target="#createClienteModal">
                    Crear Cliente
                </button>

                <!-- Fecha de Inicio y Fin -->
                <div class="form-group">
                    <label asp-for="FechaInicio" class="control-label">Fecha de Inicio</label>
                    <input asp-for="FechaInicio" class="form-control" type="date" id="fechaInicio" min="@DateTime.Now.ToString("yyyy-MM-dd")" />
                    <span asp-validation-for="FechaInicio" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="FechaFin" class="control-label">Fecha de Fin</label>
                    <input asp-for="FechaFin" class="form-control" type="date" id="fechaFin" min="@DateTime.Now.ToString("yyyy-MM-dd")" />
                    <span asp-validation-for="FechaFin" class="text-danger"></span>
                </div>

                <!-- Paquete y Precio -->
                <div class="form-group">
                    <label asp-for="IdPaquete" class="control-label">Paquete</label>
                    <select asp-for="IdPaquete" class="form-control" id="IdPaquete" asp-items="ViewBag.IdPaquete">
                        <option value="">-- Seleccionar Paquete --</option>
                    </select>
                    <span asp-validation-for="IdPaquete" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label for="PrecioPaquete">Precio Paquete</label>
                    <input type="text" id="PrecioPaquete" class="form-control" readonly />
                </div>

                <!-- Servicios Seleccionados -->
                <div class="form-group">
                    <label>Servicios</label>
                    <div id="servicios">
                        @foreach (var servicio in ViewBag.Servicios)
                        {
                            <div>
                                <input type="checkbox" name="ServiciosSeleccionados" value="@servicio.IdServicio" />
                                @servicio.Nombre - @servicio.Precio.ToString("C2", new System.Globalization.CultureInfo("es-CO"))
                            </div>
                        }
                    </div>
                </div>

                <!-- Métodos de Pago y Estado de Reserva -->
                <div class="form-group">
                    <label asp-for="IdMetodoPago" class="control-label">Método de Pago</label>
                    <select asp-for="IdMetodoPago" class="form-control" asp-items="ViewBag.IdMetodoPago"></select>
                    <span asp-validation-for="IdMetodoPago" class="text-danger"></span>
                </div>

                <!-- Descuento -->
                <div class="form-group">
                    <label asp-for="Descuento" class="control-label">Descuento (%)</label>
                    <input asp-for="Descuento" class="form-control" />
                    <span asp-validation-for="Descuento" class="text-danger"></span>
                </div>

                <!-- Subtotal, IVA y Total -->
                <div class="form-group">
                    <label>Subtotal</label>
                    <input type="text" id="subtotal" class="form-control" readonly />
                    <input type="hidden" name="Subtotal" id="hiddenSubtotal" />
                </div>
                <div class="form-group">
                    <label>IVA (19%)</label>
                    <input type="text" id="iva" class="form-control" readonly />
                    <input type="hidden" name="Iva" id="hiddenIva" />
                </div>
                <div class="form-group">
                    <label>Total</label>
                    <input asp-for="Total" class="form-control" id="total" readonly />
                    <input type="hidden" name="Total" id="hiddenTotal" />
                    <span asp-validation-for="Total" class="text-danger"></span>
                </div>
                <div class="card-footer text-center">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="fas fa-save"></i> Crear Reserva
                    </button>
                    <a asp-action="Index" class="btn btn-secondary btn-sm ml-3">
                        <i class="fas fa-arrow-left"></i> Volver a la lista
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para Crear Cliente -->
<div class="modal fade" id="createClienteModal" tabindex="-1" role="dialog" aria-labelledby="createClienteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createClienteModalLabel">Crear Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @Html.Partial("~/Views/Clientes/_CreateClienteForm.cshtml", new Proyect.Models.Cliente())
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Html.Partial("_ValidationScriptsPartial");
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Código de validaciones y cálculos...
    </script>
}
