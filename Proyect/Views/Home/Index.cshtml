@{
    ViewData["Title"] = "Dashboard";
}

<main>
    <div class="container-fluid px-4">
        <h1 class="mt-4">Dashboard</h1>
        <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item"><a href="index.html"></a></li>
            <li class="breadcrumb-item active"></li>
        </ol>
        <div class="card mb-4">
            <div class="card-body">
                Chart.js is a third party plugin that is used to generate the charts in this template. The charts below have been customized - for further customization options, please visit the official
                <a target="_blank" href="https://www.chartjs.org/docs/latest/">Chart.js documentation</a>
                <div class="dashboard">
                    <h2>Usuarios por Rol</h2>
                    <canvas id="usuariosPorRolChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-chart-area me-1"></i>
                Area Chart Example
            </div>
            <div class="card-body"><canvas id="myAreaChart" width="100%" height="30"></canvas></div>
            <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-chart-bar me-1"></i>
                        Bar Chart Example
                    </div>
                    <div class="card-body"><canvas id="myBarChart" width="100%" height="50"></canvas></div>
                    <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-chart-pie me-1"></i>
                        Pie Chart Example
                    </div>
                    <div class="card-body"><canvas id="myPieChart" width="100%" height="50"></canvas></div>
                    <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts 
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch('/api/dashboard/usuariosPorRol') // Cambia la URL si es necesario
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error al cargar los datos: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    // Procesa los datos
                    const roles = data.map(item => item.rol); // Extrae los nombres de los roles
                    const cantidades = data.map(item => item.cantidad); // Extrae las cantidades

                    // Renderiza el gráfico
                    renderChart(roles, cantidades);
                })
                .catch(error => console.error('Error:', error));
        });

        function renderChart(labels, data) {
            const ctx = document.getElementById('usuariosPorRolChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar', // Puedes usar 'bar', 'pie', 'line', etc.
                data: {
                    labels: labels, // Etiquetas (nombres de los roles)
                    datasets: [{
                        label: 'Usuarios por Rol',
                        data: data, // Cantidades de usuarios
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.2)', // Cambia los colores según tu diseño
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(255, 99, 132, 0.2)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true // Asegura que el eje Y comience en 0
                        }
                    }
                }
            });
        }

    </script>
}